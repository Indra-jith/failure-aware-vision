<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <style>
    #particleCanvas {
      display: none !important;
      position: absolute !important;
      width: 0 !important;
      height: 0 !important;
      visibility: hidden !important;
    }
  </style>
  <meta name="description"
    content="Failure-Aware Vision Trust Visualization ‚Äî Interactive research simulator for temporal trust dynamics with bounded ML influence.">
  <title>Vision Trust Simulator ‚Äî Failure-Aware Research Platform</title>
  <link rel="stylesheet" href="/css/style.css?v=5">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/3.0.1/chartjs-plugin-annotation.min.js"></script>
  <!-- Three.js for the FloatingLines hero background (local, CDN was not loading) -->
  <script src="/js/three.min.js"></script>
</head>

<body>

  <!-- Hero Landing Section -->
  <section id="hero" class="hero-section">
    <!-- FloatingLines WebGL background (sole background ‚Äî no gradient overlay) -->
    <div id="floatingLinesContainer" class="floating-lines-bg"></div>

    <!-- Hero Content -->
    <div class="hero-content">
      <div class="hero-badge">Research Platform</div>
      <h1 class="hero-title">
        <span class="hero-title-main">Failure-Aware</span>
        <span class="hero-title-sub">Vision Trust</span>
      </h1>
      <p class="hero-description">
        Interactive temporal trust engine with bounded ML influence.<br>
        Simulates vision reliability, anomaly scoring, and deterministic policy gating.
      </p>
      <button class="hero-cta" onclick="scrollToSimulator()">
        <span>Start Exploring</span>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M7 13l5 5 5-5M7 6l5 5 5-5" />
        </svg>
      </button>
    </div>

    <!-- Scroll indicator -->
    <div class="scroll-indicator">
      <div class="scroll-mouse"></div>
    </div>
  </section>

  <!-- Navigation -->
  <nav class="nav" role="navigation" aria-label="Main navigation">
    <a href="/" class="nav-brand" aria-label="Vision Trust ‚Äî Home">
      <div class="nav-brand-icon" aria-hidden="true">FV</div>
      <span class="nav-brand-text">Vision Trust</span>
      <span class="nav-brand-sub">Research Platform</span>
    </a>

    <button class="nav-hamburger" id="navHamburger" aria-label="Toggle menu" aria-expanded="false"
      aria-controls="navLinks">
      <span></span><span></span><span></span>
    </button>

    <ul class="nav-links" id="navLinks" role="list">
      <li><a href="/" class="nav-link active" aria-current="page"><span class="nav-icon" aria-hidden="true">‚ö°</span>
          Simulator</a></li>
      <li><a href="/architecture" class="nav-link"><span class="nav-icon" aria-hidden="true">‚óà</span> Architecture</a>
      </li>
      <li><a href="/playground" class="nav-link"><span class="nav-icon" aria-hidden="true">‚¨°</span> Playground</a></li>
    </ul>

    <div class="nav-actions">
      <div class="nav-ws-status">
        <div class="status-dot disconnected" id="wsStatusDot"></div>
        <span id="wsStatusText" class="nav-ws-label">Disconnected</span>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content" id="simulator">

    <div class="page-header">
      <h1>Trust Simulator</h1>
      <p>Interactive temporal trust engine with bounded ML influence and deterministic policy gating. Simulates the full
        vision reliability pipeline in real-time.</p>
    </div>

    <p class="research-question">
      Can a robot know when to stop trusting its own camera?
    </p>

    <!-- Preset scenarios -->
    <div class="scenario-bar">
      <button class="scenario-btn" onclick="runScenario('normal')">üü¢ Normal Operation
        <span class="scenario-hint">Watch baseline anomaly keep trust just below 1.0</span>
      </button>
      <button class="scenario-btn" onclick="runScenario('freeze')">üü° Freeze Attack
        <span class="scenario-hint">Observe trust velocity go negative ‚Üí DECLINING ‚Üí DEGRADED</span>
      </button>
      <button class="scenario-btn" onclick="runScenario('degrade')">üî¥ Progressive Degradation
        <span class="scenario-hint">Gradual noise increase ‚Äî watch ML anomaly drag trust slowly</span>
      </button>
      <button class="scenario-btn" onclick="runScenario('recovery')">üîµ Recovery Sequence
        <span class="scenario-hint">After corruption, recovery_debt slows the climb back</span>
      </button>
      <button class="scenario-btn" onclick="runScenario('ml_stress')">üü£ ML Stress Test
        <span class="scenario-hint">High noise with VISION_OK ‚Äî ML penalty fights recovery</span>
      </button>
    </div>

    <div class="simulator-grid">

      <!-- Left: Control Panel -->
      <div class="control-panel glass-panel">
        <div class="panel-header">
          <div class="panel-title"><span class="icon">üé•</span> Vision Simulation</div>
        </div>

        <!-- Robot World + Camera Feed two-panel layout -->
        <div class="sim-panels">
          <!-- LEFT: Robot World -->
          <div class="sim-panel">
            <div class="panel-label">Robot World</div>
            <canvas id="robotCanvas" width="380" height="200"></canvas>
            <div id="robotStatusHUD" class="robot-hud">‚óè MOVING</div>
            <!-- Robot World overlay controls -->
            <div class="rw-controls">
              <button class="rw-btn" id="rwPlayPauseBtn" title="Play / Pause simulation"
                onclick="rwState.paused=!rwState.paused; this.textContent=rwState.paused?'‚ñ∂ Play':'‚è∏ Pause'">‚è∏
                Pause</button>
              <button class="rw-btn" id="rwGridBtn" title="Toggle perspective grid"
                onclick="rwState.gridOn=!rwState.gridOn; this.classList.toggle('active')">‚äû Grid</button>
            </div>
          </div>

          <!-- RIGHT: Camera Feed -->
          <div class="sim-panel">
            <div class="panel-label">Camera Feed</div>
            <canvas id="visionCanvas" width="380" height="200"></canvas>
            <div id="visionBadge" class="vision-status-badge ok">VISION_OK</div>
          </div>
        </div>

        <!-- Mode buttons -->
        <div class="control-group">
          <div class="control-label">Failure Mode</div>
          <div class="mode-buttons">
            <button class="mode-btn active" data-mode="normal" onclick="setMode('normal', this)">‚úì Normal</button>
            <button class="mode-btn frozen" data-mode="frozen" onclick="setMode('frozen', this)">‚è∏ Freeze</button>
            <button class="mode-btn blank" data-mode="blank" onclick="setMode('blank', this)">‚óª Blank</button>
            <button class="mode-btn corrupted" data-mode="corrupted" onclick="setMode('corrupted', this)">‚ö†
              Corrupt</button>
          </div>
        </div>

        <!-- Noise slider -->
        <div class="control-group">
          <div class="slider-group">
            <div class="slider-header">
              <span class="slider-label">Gaussian Noise</span>
              <span class="slider-value" id="noiseValue">0.00</span>
            </div>
            <input type="range" id="noiseSlider" min="0" max="100" value="0" oninput="setNoise(this.value)">
          </div>

          <div class="slider-group">
            <div class="slider-header">
              <span class="slider-label">Brightness</span>
              <span class="slider-value" id="brightnessValue">0.50</span>
            </div>
            <input type="range" id="brightnessSlider" min="0" max="100" value="50" oninput="setBrightness(this.value)">
          </div>
        </div>

        <!-- Actions -->
        <div class="action-bar">
          <button class="action-btn danger" onclick="resetSimulation()">‚Ü∫ Reset</button>
          <button class="action-btn primary" onclick="downloadLog()">‚Üì CSV</button>
        </div>
      </div>

      <!-- Top right: Dashboard -->
      <div class="dashboard-panel glass-panel">
        <div class="panel-header">
          <div class="panel-title"><span class="icon">üìä</span> Live Trust Dashboard</div>
          <div id="policyBadge" class="policy-badge allowed">‚óè ALLOWED</div>
        </div>

        <div class="dashboard-grid">
          <!-- Gauge -->
          <div class="gauge-container">
            <canvas id="reliabilityGauge" width="180" height="180"></canvas>
            <div class="gauge-label">Reliability Index</div>
          </div>

          <!-- Metrics -->
          <div class="metrics-grid">
            <div class="metric-card">
              <div class="metric-label">Reliability</div>
              <div class="metric-value cyan" id="metricReliability">1.000</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Anomaly Score</div>
              <div class="metric-value" id="metricAnomaly">0.000</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Anomaly Integral</div>
              <div class="metric-value" id="metricIntegral">0.000</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Decay Coefficient</div>
              <div class="metric-value" id="metricDecay">-0.10</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Recovery Rate</div>
              <div class="metric-value" id="metricRecovery">0.10</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Vision State</div>
              <div class="metric-value green" id="metricVision">OK</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">ML Influence</div>
              <div class="ml-indicator active" id="metricML">‚óè ACTIVE</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Tick Count</div>
              <div class="metric-value" id="metricTick">0</div>
            </div>

            <!-- Trust Velocity -->
            <div class="metric-card">
              <div class="metric-label">VELOCITY</div>
              <div id="metricVelocity" class="metric-value">+0.000</div>
              <div class="metric-unit">/s</div>
            </div>

            <!-- Recovery Debt -->
            <div class="metric-card">
              <div class="metric-label">REC. DEBT</div>
              <div id="metricDebt" class="metric-value">0.000</div>
              <div class="metric-unit">acc</div>
            </div>

            <!-- ML Conflicts -->
            <div class="metric-card">
              <div class="metric-label">CONFLICTS</div>
              <div id="metricConflictCount" class="metric-value">0</div>
              <div id="metricConflictIndicator" class="conflict-chip consensus">‚úì</div>
            </div>

            <!-- Robot Speed -->
            <div class="metric-card">
              <div class="metric-label">ROBOT SPD</div>
              <div id="metricRobotSpeed" class="metric-value">100%</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Failure Attribution Summary (live, populated every tick) -->
      <div class="chart-panel glass-panel" style="padding: 0.85rem 1.25rem;">
        <div class="panel-header" style="margin-bottom: 0.5rem;">
          <div class="panel-title"><span class="icon">‚ö†</span> Failure Attribution</div>
        </div>
        <div id="failureSummaryPanel" class="failure-summary-panel none">
          No trust excursions recorded.
        </div>
      </div>

      <!-- Bottom right: Charts -->
      <div class="chart-panel glass-panel">
        <div class="panel-header">
          <div class="panel-title"><span class="icon">üìà</span> Time-Series</div>
          <div class="chart-controls">
            <button class="chart-btn active" onclick="setChartView('both', this)">All</button>
            <button class="chart-btn" onclick="setChartView('reliability', this)">Reliability</button>
            <button class="chart-btn" onclick="setChartView('anomaly', this)">Anomaly</button>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="timeSeriesChart"></canvas>
        </div>
      </div>

    </div>
  </main>

  <script src="/js/gauge.js"></script>
  <script src="/js/charts.js"></script>
  <script src="/js/ws.js"></script>
  <script src="/js/floating-lines.js"></script>
  <script src="/js/app.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const heroContainer = document.getElementById('floatingLinesContainer');
      if (heroContainer && typeof FloatingLines !== 'undefined' && typeof THREE !== 'undefined') {
        new FloatingLines(heroContainer, {
          enabledWaves: ['top', 'bottom'],
          lineCount: 8,
          lineDistance: 11,
          bendRadius: 40,
          bendStrength: -0.3,
          interactive: true,
          parallax: true,
          animationSpeed: 1.7,
          mouseDamping: 0.06,
          parallaxStrength: 0.15,
          linesGradient: ['#00f0ff', '#7b2fff', '#ff00aa', '#00f0ff'],
        });
      }

      // Hamburger menu toggle
      const hamburger = document.getElementById('navHamburger');
      const navLinks = document.getElementById('navLinks');
      if (hamburger && navLinks) {
        hamburger.addEventListener('click', () => {
          const open = navLinks.classList.toggle('open');
          hamburger.setAttribute('aria-expanded', open);
        });
      }
    });
  </script>

</body>

</html>