<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="ML Playground ‚Äî simulate anomaly scoring, compare frames, and observe trust evolution from video input.">
    <title>ML Playground ‚Äî Vision Trust Platform</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
    <script src="/js/three.min.js"></script>
</head>

<body>

    <!-- Floating lines background (fixed, behind all content) -->
    <div id="floatingLinesBg" class="page-floating-bg"></div>

    <nav class="nav" role="navigation" aria-label="Main navigation">
        <a href="/" class="nav-brand" aria-label="Vision Trust ‚Äî Home">
            <div class="nav-brand-icon" aria-hidden="true">FV</div>
            <span class="nav-brand-text">Vision Trust</span>
            <span class="nav-brand-sub">Research Platform</span>
        </a>

        <button class="nav-hamburger" id="navHamburger" aria-label="Toggle menu" aria-expanded="false"
            aria-controls="navLinks">
            <span></span><span></span><span></span>
        </button>

        <ul class="nav-links" id="navLinks" role="list">
            <li><a href="/" class="nav-link"><span class="nav-icon" aria-hidden="true">‚ö°</span> Simulator</a></li>
            <li><a href="/architecture" class="nav-link"><span class="nav-icon" aria-hidden="true">‚óà</span>
                    Architecture</a></li>
            <li><a href="/playground" class="nav-link active" aria-current="page"><span class="nav-icon"
                        aria-hidden="true">‚¨°</span> Playground</a></li>
        </ul>

        <div class="nav-actions">
            <div class="nav-ws-status">
                <div class="status-dot disconnected" id="pgWsDot"></div>
                <span id="pgWsText" class="nav-ws-label">Disconnected</span>
            </div>
        </div>
    </nav>

    <main class="main-content">

        <div class="page-header fade-in-up">
            <h1>ML Playground</h1>
            <p>Upload a video to simulate anomaly scoring, compare raw vs reconstructed frames, and observe trust
                evolution through the temporal trust engine. Uses heuristic proxy ‚Äî no PyTorch required.</p>
        </div>

        <div class="playground-grid fade-in-up" style="animation-delay: 0.1s;">

            <!-- Left: Upload & Frame Comparison -->
            <div>
                <!-- Upload zone -->
                <div class="glass-panel" style="margin-bottom: 1.25rem;">
                    <div class="panel-header">
                        <div class="panel-title"><span class="icon">üì§</span> Video Input</div>
                    </div>
                    <div class="upload-zone" id="uploadZone" role="button" tabindex="0"
                        aria-label="Click or drop video file to upload"
                        onclick="document.getElementById('videoInput').click()"
                        onkeydown="if(event.key==='Enter')document.getElementById('videoInput').click()">
                        <div class="upload-icon" aria-hidden="true">üé¨</div>
                        <div class="upload-text">Click or drop a video file</div>
                        <div class="upload-sub">Supports MP4, WebM, AVI ‚Äî max 50MB</div>
                    </div>
                    <input type="file" id="videoInput" accept="video/*" style="display:none;"
                        onchange="handleVideoUpload(event)">

                    <!-- Video playback (hidden until loaded) -->
                    <video id="videoPlayer"
                        style="display:none; width:100%; border-radius:var(--radius-sm); margin-top:1rem;"
                        muted></video>

                    <!-- Video analysis summary -->
                    <div id="videoAnalysisSummary"
                        style="display:none; margin-top:0.75rem; padding:0.75rem; background:rgba(0,0,0,0.25); border-radius:var(--radius-sm);">
                    </div>
                    <!-- Video timeline bar -->
                    <div id="videoTimeline"
                        style="display:none; margin-top:0.5rem; padding:0.5rem; background:rgba(0,0,0,0.2); border-radius:var(--radius-sm);">
                    </div>

                    <!-- Sequence builder -->
                    <div style="margin-top: 1.25rem;">
                        <div class="control-label">Or: Build a Simulated Sequence</div>
                        <div class="scenario-bar" style="margin-top: 0.5rem;">
                            <button class="scenario-btn" onclick="buildSequence('normal_stable')">üü¢ Stable
                                (5s)</button>
                            <button class="scenario-btn" onclick="buildSequence('gradual_decay')">üìâ Gradual
                                Decay</button>
                            <button class="scenario-btn" onclick="buildSequence('freeze_recovery')">üîÑ Freeze ‚Üí
                                Recover</button>
                            <button class="scenario-btn" onclick="buildSequence('full_cycle')">üîÅ Full Cycle</button>
                        </div>
                    </div>
                </div>

                <!-- Frame comparison -->
                <div class="glass-panel">
                    <div class="panel-header">
                        <div class="panel-title"><span class="icon">üî¨</span> Frame Comparison</div>
                        <span
                            style="font-size: 0.7rem; color: var(--text-tertiary); font-family: var(--font-mono);">Frame
                            <span id="currentFrameNum">0</span></span>
                    </div>
                    <div class="frame-comparison">
                        <div class="frame-box">
                            <canvas id="rawFrameCanvas" width="256" height="192"></canvas>
                            <div class="frame-box-label">Raw Input</div>
                        </div>
                        <div class="frame-box">
                            <canvas id="reconFrameCanvas" width="256" height="192"></canvas>
                            <div class="frame-box-label">Reconstructed (Simulated)</div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; text-align: center;">
                        <div class="metric-label">Reconstruction Error (Anomaly Score)</div>
                        <div class="metric-value magenta" id="pgAnomalyScore" style="font-size: 1.3rem;">0.000000</div>
                    </div>
                </div>
            </div>

            <!-- Right: Trust Evolution Charts -->
            <div>
                <!-- Evolution chart -->
                <div class="glass-panel" style="margin-bottom: 1.25rem;">
                    <div class="panel-header">
                        <div class="panel-title"><span class="icon">üìà</span> Trust Evolution</div>
                    </div>
                    <div class="chart-container" style="height: 220px;">
                        <canvas id="pgReliabilityChart"></canvas>
                    </div>
                </div>

                <!-- Anomaly chart -->
                <div class="glass-panel" style="margin-bottom: 1.25rem;">
                    <div class="panel-header">
                        <div class="panel-title"><span class="icon">‚ö°</span> Anomaly Score</div>
                    </div>
                    <div class="chart-container" style="height: 180px;">
                        <canvas id="pgAnomalyChart"></canvas>
                    </div>
                </div>

                <!-- Results summary -->
                <div class="glass-panel">
                    <div class="panel-header">
                        <div class="panel-title"><span class="icon">üìä</span> Session Summary</div>
                    </div>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">Total Frames</div>
                            <div class="metric-value" id="pgTotalFrames">0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Final Reliability</div>
                            <div class="metric-value cyan" id="pgFinalReliability">1.000</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Min Reliability</div>
                            <div class="metric-value red" id="pgMinReliability">1.000</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Mean Anomaly</div>
                            <div class="metric-value magenta" id="pgMeanAnomaly">0.000</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Policy Changes</div>
                            <div class="metric-value" id="pgPolicyChanges">0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Time Blocked</div>
                            <div class="metric-value red" id="pgTimeBlocked">0.0s</div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <script src="/js/ws.js"></script>
    <script src="/js/playground.js"></script>
    <script src="/js/floating-lines.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const bg = document.getElementById('floatingLinesBg');
            if (bg && typeof FloatingLines !== 'undefined' && typeof THREE !== 'undefined') {
                new FloatingLines(bg, {
                    enabledWaves: ['top', 'bottom'],
                    lineCount: 8,
                    lineDistance: 11,
                    bendRadius: 40,
                    bendStrength: -0.3,
                    interactive: false,
                    parallax: false,
                    animationSpeed: 0.6,
                    linesGradient: ['#00f0ff', '#7b2fff', '#ff00aa', '#00f0ff'],
                });
            }

            // Hamburger menu
            const hamburger = document.getElementById('navHamburger');
            const navLinks = document.getElementById('navLinks');
            hamburger.addEventListener('click', () => {
                const open = navLinks.classList.toggle('open');
                hamburger.setAttribute('aria-expanded', open);
            });
        });
    </script>

</body>

</html>